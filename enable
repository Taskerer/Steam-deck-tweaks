#!/usr/bin/env bash

echo "DISCLAIMER: This script makes performance tweaks to your system."
echo "The authors of this script are not responsible for any damage or loss resulting from its use."
echo "Use this script at your own risk."
echo "Please type 'agree' to accept the terms and proceed with the script."

# Read the user input
read -r user_input </dev/tty

# Check if the user input matches "agree"
if [[ $user_input != "agree" ]]; then
    echo "You did not agree to the terms. Exiting the script."
    exit 1
fi

cat << EOF | sudo tee /etc/tmpfiles.d/mglru.conf
w /sys/kernel/mm/lru_gen/enabled - - - - 7
w /sys/kernel/mm/lru_gen/min_ttl_ms - - - - 0
EOF
cat << EOF | sudo tee /etc/security/limits.d/memlock.conf
* hard memlock 2147484
* soft memlock 2147484
EOF
cat << EOF | sudo tee /etc/udev/rules.d/64-ioschedulers.rules
ACTION=="add|change", KERNEL=="nvme[0-9]*", ATTR{queue/scheduler}="none"
ACTION=="add|change", KERNEL=="sd[a-z]|mmcblk[0-9]*", ATTR{queue/rotational}=="0", ATTR{queue/scheduler}="none"
EOF
sudo sed -i -e '/home/s/\bdefaults\b/&,noatime/' /etc/fstab